---
name: cf-redis-broker

templates:
  cf-redis-broker_ctl.erb: bin/cf-redis-broker_ctl
  nginx_ctl.erb: bin/nginx_ctl
  route-registrar_ctl: bin/route-registrar_ctl

  broker.yml.erb: config/broker.yml
  nginx.conf.erb: config/nginx.conf
  registrar_settings.yml.erb: config/registrar_settings.yml

packages:
- cf-redis-broker
- nginx
- route-registrar
- python

properties:
  redis.broker.statefile_path:
     default: /var/vcap/store/cf-redis-broker/statefile.json
     description: Path to the broker statefile
  redis.broker.service_name:
    description: Service name displayed in the catalog metadata
    default: p-redis
  redis.broker.auth.username:
    default: admin
    description: The username for HTTP Basic Auth on the Broker, also used for the agent
  redis.broker.auth.password:
    default: admin
    description: The password for HTTP Basic Auth on the Broker, also used for the agent
  redis.broker.backend_port:
    default: 10005
    description: The port for the broker unicorn process to run on
  redis.broker.backend_host:
    default: localhost
    description: The port for the broker unicorn process to run on
  redis.broker.subdomain:
    default: redis-broker
    description: Subdomain for route registrar

  redis.broker.dedicated_nodes:
    description: List of node IPs for the dedicated plan
    default: []
  redis.broker.dedicated_port:
    description: The port used by the redis instances
    default: 6379

  redis.broker.agent_port:
    description: The port used to talk to the agent
    default: 443
    
  ################# Added by Bin Cheng Shuai to support shared redis node####
  redis.broker.shared_nodes:
    description: List of shared node ips or host for shared service
    default: []
  redis.broker.shared_port:
    description: The port is used by shared node redis instances
    default: 6379
  ##########################################################################
  
  redis.broker.name:
    default: redis
    description: Name of the broker, to be used in cf commandline operations and by the broker-registrar

  redis.broker.network:
    description: The name of the network that the redis broker runs on.

  cf.apps_domain:
    description: Domain shared by the UAA and CF API eg 'bosh-lite.com'
  cf.nats.host:
    description: Hostname/IP of NATS
  cf.nats.port:
    description: Port that NATS listens on
  cf.nats.username:
    description: The user to use when authenticating with NATS
  cf.nats.password:
    description: The password to use when authenticating with NATS

## added by Bin Cheng Shuai ######
  redis.broker.test:
    default: value
    description: for testing
  redis.broker.serviceKeysSupported:
    defalut: false
    description: Support service keys or not
  redis.broker.services:
    description: 'Services and plans offered by the broker'
    example: |
      plans:
      - name: 100mb
        id: REPLACE-WITH-A-UNIQUE-GUID
        description: Shared MySQL Server
        max_storage_mb: 100 
        max_user_connections: 20
      - name: 1gb 
        id: REPLACE-WITH-A-UNIQUE-GUID
        description: Shared MySQL Server
        max_storage_mb: 1000
        max_user_connections: 40
  redis.broker.max_client_connections_default:
    description: 'Default maxinium number of user clients'
    default: 20

  
### End of Block ######
