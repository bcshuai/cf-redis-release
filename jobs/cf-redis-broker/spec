---
name: cf-redis-broker

templates:
  cf-redis-broker_ctl.erb: bin/cf-redis-broker_ctl
  nginx_ctl.erb: bin/nginx_ctl
  route-registrar_ctl: bin/route-registrar_ctl

  broker.yml.erb: config/broker.yml
  nginx.conf.erb: config/nginx.conf
  registrar_settings.yml.erb: config/registrar_settings.yml

packages:
- cf-redis-broker
- nginx
- route-registrar
- python

properties:
  redis.broker.statefile_path:
     default: /var/vcap/store/cf-redis-broker/statefile.json
     description: Path to the broker statefile
  redis.broker.service_name:
    description: Service name displayed in the catalog metadata
    default: p-redis
  redis.broker.auth.username:
    default: admin
    description: The username for HTTP Basic Auth on the Broker, also used for the agent
  redis.broker.auth.password:
    default: admin
    description: The password for HTTP Basic Auth on the Broker, also used for the agent
  redis.broker.backend_port:
    default: 10005
    description: The port for the broker unicorn process to run on
  redis.broker.backend_host:
    default: localhost
    description: The port for the broker unicorn process to run on
  redis.broker.subdomain:
    default: redis-broker
    description: Subdomain for route registrar

  redis.broker.dedicated_nodes:
    description: List of node IPs for the dedicated plan
    default: []
  redis.broker.dedicated_port:
    description: The port used by the redis instances
    default: 6379

  redis.broker.agent_port:
    description: The port used to talk to the agent
    default: 443
    
  ################# Added by Bin Cheng Shuai to support shared redis node####
  redis.broker.shared_nodes:
    description: List of shared node ips or host for shared service
    default: []
  redis.broker.shared_port:
    description: The port is used by shared node redis instances
    default: 6379
  ##########################################################################
  
  redis.broker.name:
    default: redis
    description: Name of the broker, to be used in cf commandline operations and by the broker-registrar

  redis.broker.network:
    description: The name of the network that the redis broker runs on.

  cf.apps_domain:
    description: Domain shared by the UAA and CF API eg 'bosh-lite.com'
  cf.nats.host:
    description: Hostname/IP of NATS
  cf.nats.port:
    description: Port that NATS listens on
  cf.nats.username:
    description: The user to use when authenticating with NATS
  cf.nats.password:
    description: The password to use when authenticating with NATS

## added by Bin Cheng Shuai ######
  redis.broker.serviceKeysSupported:
    defalut: false
    description: Support service keys or not
  redis.broker.services:
    default: []
    example: |
      id:
        description: redis broker id
      name:
        description: redis broler name
        default: redis
      bindable:
        description: indicates whether service instances can be bound to applications
        default: true
      description: Services and plans offered by the broker
      plan_updateable:
        description: indicates whether the service supports plan changes
        default: false
      metadata:
        displayName:
          description: The name that is displayed in the Bluemix user interface for a service.
        imageUrl:
          description: The URL of a large image
        smallImageUrl:
          description: the url of a small image
        mediumImageUrl:
          description: the url of a medirm image
        featuredImageUrl:
          description: the url of a feature image
        longDescription:
          description: the description of the service
        providerDisplayName:
          description: the provider of the service
          default: IBM BlueMix
        documentationUrl:
          description: the url of the document
        supportUrl:
          description: The URL of documentation about the service.
        serviceKeysSupported:
          description: A boolean value that indicates whether the service keys API is supported
          default: false
        serviceMonitorApi:
          description: the monitor api
        type:
          description: The type of the service.
          default: referral
      tags:
      - data_management
      - ibm_created
 
      plans:
      - description: Shared Reis Server
        id: ab08f1bc-e6fc-4b56-a767-ee0fea794365
        max_memory_mb: 128
        max_client_connections: 20
        free: false
        name: 128mb_20_connections
      - description: Shared Redis Server
        id: de08f1bc-e6fc-4b56-a767-ee0fe7943765
        max_memory_mb: 256
        free: false
        max_client_connections: 30
        name: 256mb_30_connections
      - description: Shared Redis Server
        id: 11d0aa36-dcec-4021-85f5-ea4d9a796300
        max_memory_mb: 256
        free: false
        max_client_connections: 80
        name: 256mb_80_connections
  redis.broker.max_client_connections_default:
    description: 'Default maxinium number of user clients'
    default: 20

  
### End of Block ######
